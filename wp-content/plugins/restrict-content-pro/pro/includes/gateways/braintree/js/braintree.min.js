!function(e){var t={};function n(r){var i;return(t[r]||(i=t[r]={i:r,l:!1,exports:{}},e[r].call(i.exports,i,i.exports,n),i.l=!0,i)).exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){function n(e){let t=jQuery,n=t("#rcp_registration_form");t("#rcp-braintree-dropin-errors").empty().append('<div class="rcp_message error" role="list"><p class="rcp_error" role="listitem">'+e+"</p>"),0<n.length&&(n.unblock(),t("#rcp_submit").val(rcp_script_options.register)),rcp_processing=!1}jQuery((function(e){var t={dropinInstance:!1,hasCardDetails:!1,init:function(){e("body").on("rcp_gateway_loaded",t.mountUI),e("#rcp_submit").on("click",t.maybeBlockSubmit),e("body").on("rcp_registration_form_processed",t.tokenizePayment)},mountUI:function(r,i){document.getElementById("rcp-braintree-client-token")&&(rcp_braintree_script_options.dropin_ui_config={authorization:e("#rcp-braintree-client-token").val(),container:"#rcp-braintree-dropin-container",threeDSecure:!0},braintree.dropin.create(rcp_braintree_script_options.dropin_ui_config).then((function(e){(t.dropinInstance=e).isPaymentMethodRequestable()&&(t.hasCardDetails=!0),e.on("paymentMethodRequestable",(function(e){t.hasCardDetails=!0})),e.on("noPaymentMethodRequestable",(function(e){t.hasCardDetails=!1}))})).catch((function(e){n(e)})))},maybeBlockSubmit:function(e){if("braintree"===rcp_get_gateway().val()&&document.getElementById("rcp-braintree-client-token")&&!t.hasCardDetails)return e.stopPropagation(),n(rcp_script_options.enter_card_details),!1},registerTestInformation:function(){setTimeout((function(){e("#rcp_braintree_test_check").on("click",(function(t){!0===e(this).prop("checked")?(e("#rcp_braintree_billing_lastname").val("Doe"),e("#rcp_braintree_billing_phoneNumber").val("1234567890"),e("#rcp_braintree_billing_firstname").val("Santino")):(e("#rcp_braintree_billing_lastname").val(""),e("#rcp_braintree_billing_phoneNumber").val(""),e("#rcp_braintree_billing_firstname").val(""))}))}),2500)},tokenizePayment:function(r,i,a){if(document.getElementById("rcp-braintree-client-token")&&"braintree"===rcp_get_gateway().val()){let r=rcp_braintree_script_options.payment_method_options,c={};var o;void 0!==r.threeDSecure&&""===r.threeDSecure.email&&(r.threeDSecure.email=e("#rcp_user_email").val()),void 0!==r.threeDSecure&&void 0!==r.threeDSecure.additionalInformation&&""===r.threeDSecure.additionalInformation.deliveryEmail&&(c.deliveryEmail=e("#rcp_user_email").val()),o={givenName:e("#rcp_braintree_billing_firstname").val(),surname:e("#rcp_braintree_billing_lastname").val(),phoneNumber:e("#rcp_braintree_billing_phoneNumber").val()},e.when(e.ajax({type:"post",dataType:"json",url:rcp_script_options.ajaxurl,data:{action:"rcp_braintree_3ds_validation_fields",nonce:e("#braintree_3ds_nonce").val(),billingAddress:o}})).then((function(o){if(!o.success)throw"RCP 3DS: There was an error validating you information.";for(const e in o.data.billingAddress)if(""===o.data.billingAddress[e])return n(rcp_script_options.braintree_empty_fields),!1;r.threeDSecure.billingAddress=o.data.billingAddress,r.threeDSecure.additionalInformation=c,void 0!==r.threeDSecure&&(r.threeDSecure.amount=0<a.total?a.total:a.recurring_total),t.dropinInstance.requestPaymentMethod(r).then((function(r){r.liabilityShiftPossible&&!r.liabilityShifted?(t.dropinInstance.clearSelectedPaymentMethod(),n(rcp_braintree_script_options.try_new_payment)):(e(i).find("#rcp_submit_wrap").append('<input type="hidden" name="payment_method_nonce" value="'+r.nonce+'"/>'),rcp_submit_registration_form(i,a))})).catch((function(e){n(e)}))})).fail((function(e){throw n(rcp_script_options.braintree_invalid_nonce),"RCP 3DS: There was an error validating you information. Nonce expired. Reload the page."}))}}};t.init(),t.registerTestInformation();let r={container:!1,recurringAmount:0,hasCardDetails:!1,init:function(){r.container=e("#rcp_update_card_form"),r.container.length&&(r.mountUI(),r.container.on("submit",r.tokenizePayment))},mountUI:function(){if(document.getElementById("rcp-braintree-client-token")){rcp_braintree_script_options.dropin_ui_config.authorization=e("#rcp-braintree-client-token").val();let t=rcp_braintree_script_options.dropin_ui_config;t.preselectVaultedPaymentMethod=!1,braintree.dropin.create(t).then((function(e){(r.dropinInstance=e).isPaymentMethodRequestable()&&(r.hasCardDetails=!0),e.on("paymentMethodRequestable",(function(e){r.hasCardDetails=!0})),e.on("noPaymentMethodRequestable",(function(e){r.hasCardDetails=!1}))})).catch((function(e){n(e)}))}},disableButton:function(){let e=r.container.find("#rcp_submit");e.prop("disabled",!0).data("text",e.val()).val(rcp_braintree_script_options.please_wait)},enableButton:function(){let e=r.container.find("#rcp_submit");e.prop("disabled",!1).val(e.data("text"))},tokenizePayment:function(t){if(t.preventDefault(),!r.hasCardDetails)return n(rcp_script_options.enter_card_details),!1;e("#rcp-braintree-dropin-errors").empty(),r.disableButton();let i=rcp_braintree_script_options.payment_method_options;i.threeDSecure.amount=e("#rcp-braintree-recurring-amount").val(),r.dropinInstance.requestPaymentMethod(i).then((function(e){if(e.liabilityShiftPossible&&!e.liabilityShifted)throw r.dropinInstance.clearSelectedPaymentMethod(),rcp_braintree_script_options.try_new_payment;r.container.append('<input type="hidden" name="payment_method_nonce" value="'+e.nonce+'"/>'),r.container.off("submit",r.tokenizePayment).submit()})).catch((function(e){return n(e),r.enableButton(),!1}))}};r.init()}))}]);
//# sourceMappingURL=braintree.min.js.map