!function(a){"use strict";const b=window.Swal.mixin({customClass:{confirmButton:"btn btn-primary shadow-none me-xxl-3",cancelButton:"btn btn-danger shadow-none"},buttonsStyling:!1});a(document).ready(function(){function c(b){var c=0;b=""===b?"all":b,a(".fm-integrations .card").each(function(){a(this).text().search(new RegExp(b,"i"))<0?a(this).parent().hide():(a(this).parent().fadeIn(),c++),a(".integrations-count").html(c)}),a(".integrations-nav .active").removeClass("active"),a('.fm-filter-integration[data-filter="'+b+'"]').addClass("active")}function d(b){var c=0;b=""===b?"all":b,a(".fm-workflow-rows tr:not( .empty-rows )").each(function(){a(this).hasClass(b)?(a(this).fadeIn(),c++):a(this).hide(),a(".workflow-count").html(c)}),a(".workflows-nav .active").removeClass("active"),a('.fm-filter-workflow[data-filter="'+b+'"]').addClass("active"),a("body").find(".selected-folder").removeClass("selected-folder")}function e(){a("body").find(".fm-workflow-apps-popup").fadeOut().removeClass("fm-active"),clearInterval(f)}var f,g=a(".workflow-folder"),h=a(".workflow-status"),i=a(".task-workflow-filter"),j=a(".fm-workflows-filters .btn-apply-changes"),k=a(".flowmattic-delete-workflow"),l=a(".flowmattic-delete-task-history"),m=a(".flowmattic-install-app"),n=a(".flowmattic-delete-app"),o=a(".search-integrations"),p=a(".flowmattic-save-settings"),q=a(".needs-registration"),r=a(".flowmattic-export-workflow"),s=(a("#workflow_import_file"),a(".flowmattic-clone-workflow")),t=(a(".btn-import-workflow"),a(".fm-filter-integration")),u=a(".fm-filter-workflow"),v=a(".btn-re-execute-task"),w=a(".btn-re-execute"),x=a(".btn-dismis-modal"),y=a(".fm-workflow-popup-trigger"),z=a(".flowmattic-disable-core-app"),A=a(".flowmattic-enable-core-app");a(".fm-select").selectpicker(),c(-1!==window.location.href.indexOf("tab=update")?"update":"all"),d("all"),o.keyup(function(){c(a(this).val())}),t.on("click",function(){c(a(this).data("filter"))}),u.on("click",function(){d(a(this).data("filter")),a(".workflow-folders").removeClass("text-primary"),a(".selected-folder-text").html("All")}),m.on("click",function(c){var d=a(this).data("url"),e=a(this).data("integration"),f=a(this).data("security"),g="Update"===a(this).text()?"Updating":"Installing",h="Update"===a(this).text()?"updated":"installed";c.preventDefault(),b.fire({title:g+" application",showConfirmButton:!1,didOpen:function(){b.showLoading()}}),a.ajax({url:ajaxurl,data:{action:"flowmattic_install_app",appURL:d,slug:e,security:f},type:"POST",dataType:"json",success:function(a){"error"===a.status?b.fire({title:"Error!",text:a.message,icon:"error",showConfirmButton:!0,timer:5e3}):(b.fire({title:"Application "+h+"!",text:"Selected application is "+h+" successfully.",icon:"success",showConfirmButton:!1,timer:1500}),setTimeout(function(){window.location=window.location.href},500))}})}),n.on("click",function(c){var d=a(this).data("integration"),e=a(this).data("security");c.preventDefault(),b.fire({title:"Are you sure?",text:"Once the selected app is deleted, your workflows using this integration will be paused till you manually inspect and publish them.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",showLoaderOnConfirm:!0}).then(function(c){c.isConfirmed&&(b.fire({title:"Removing application",showConfirmButton:!1,didOpen:function(){b.showLoading()}}),a.ajax({url:ajaxurl,data:{action:"flowmattic_delete_app",slug:d,security:e},type:"POST",dataType:"json",success:function(a){"error"===a.status?b.fire({title:"Error!",text:a.message,icon:"error",showConfirmButton:!0,timer:5e3}):(b.fire({title:"Application Removed!",text:"Selected application is removed successfully.",icon:"success",showConfirmButton:!1,timer:1500}),setTimeout(function(){window.location=window.location.href},700))}}))})}),g.on("click",function(){var b=a(this).attr("data-folder-name");a(".workflows-nav .active").removeClass("active"),a("body").find(".selected-folder").removeClass("selected-folder"),a(this).siblings().removeClass("selected-folder"),a(this).addClass("selected-folder"),a(".workflow-folders").addClass("text-primary"),a(".selected-folder-text").html(a(this).find("h4").text()),a.when(a("."+b).siblings().hide()).done(function(){a("."+b).fadeIn("200"),a(".workflow-count").html(a("."+b).length)})}),h.on("click",function(){var b=this,c=a(this).attr("data-status-name");a(".flowmattic-workflow-folders").find(".selected-folder").removeClass("selected-folder"),a(this).siblings().removeClass("selected-folder"),a(this).addClass("selected-folder"),a.when(a("."+c).siblings().fadeOut("100")).done(function(){a("."+c).fadeIn("200"),a(b).addClass("selected-folder")})}),i.length&&(i.selectpicker(),a(".task-date-ranges").daterangepicker({ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},alwaysShowCalendars:!0,startDate:""!==a(".task-date-ranges").attr("data-start-date")?a(".task-date-ranges").attr("data-start-date"):moment().subtract(29,"days"),endDate:""!==a(".task-date-ranges").attr("data-end-date")?a(".task-date-ranges").attr("data-end-date"):moment(),buttonClasses:"btn btn-md"},function(a,b,c){})),a(".task-date-ranges").on("cancel.daterangepicker",function(b,c){a(".task-date-ranges").val("")}),j.on("click",function(){var b=encodeURI(a(".task-date-ranges").val()),c=a(".task-workflow-filter option:selected").val();a("#task-filters-modal").modal("hide"),window.location=FMConfig.tasksAdmin+"&date_range="+b+"&workflow-id="+c}),k.on("click",function(){var c=a(this).attr("data-workflow-id");b.fire({title:"Are you sure?",text:"You won't be able to revert this! The workflow and associated tasks will also be deleted.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",showLoaderOnConfirm:!0}).then(function(d){d.isConfirmed&&(a('tr[data-workflow-id="'+c+'"]').animate({opacity:0},1e3,function(){a(this).remove()}),a.ajax({url:ajaxurl,data:{workflow_id:c,action:"flowmattic_delete_workflow",workflow_nonce:FMConfig.workflow_nonce},type:"POST",dataType:"json",success:function(a){b.fire({title:"Workflow Deleted!",text:"Selected workflow has been deleted.",icon:"success",showConfirmButton:!1,timer:1500})}}))})}),l.on("click",function(){var c=a(this).attr("data-workflow-id");b.fire({title:"Are you sure?",text:"You won't be able to revert this! The task history associated with this workflow will be deleted.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",showLoaderOnConfirm:!0}).then(function(d){d.isConfirmed&&a.ajax({url:ajaxurl,data:{workflow_id:c,action:"flowmattic_delete_workflow_task_history",workflow_nonce:FMConfig.workflow_nonce},type:"POST",dataType:"json",success:function(a){b.fire({title:"Task History Deleted!",text:"Task history for the selected workflow has been deleted.",icon:"success",showConfirmButton:!1,timer:1500})}})})}),p.on("click",function(){var c=a(".flowmattic-settings-form").serializeArray(),d={};a.each(c,function(a,b){d[b.name]=b.value}),b.fire({title:"Updating Settings",showConfirmButton:!1,didOpen:function(){b.showLoading()}}),a.ajax({url:ajaxurl,data:{settings:d,action:"flowmattic_save_settings",workflow_nonce:FMConfig.workflow_nonce},type:"POST",success:function(a){b.fire({title:"Settings Saved!",text:"Your settings have been saved successfully.",icon:"success",showConfirmButton:!1,timer:1500})}})}),q.on("click",function(){b.fire({title:"License not active!",html:'<p class="fs-5">In order to create workflows, first, you need to validate your license key.</p>',icon:"warning",showConfirmButton:!0,timer:3500})}),r.on("click",function(b){var c=a(this).data("workflow-id"),d={action:"flowmattic_export_workflow",workflowID:c,workflow_nonce:FMConfig.workflow_nonce};b.preventDefault(),a.ajax({type:"POST",url:ajaxurl,data:d,success:function(a){var b,d=document.createElement("a");const e=JSON.stringify(a),f=(new TextEncoder).encode(e),g=new Blob([f],{type:"application/json;charset=utf-8"});b=window.URL.createObjectURL(g),d.href=b,d.download="flowmattic-workflow-"+c+".json",document.body.append(d),d.click(),d.remove(),window.URL.revokeObjectURL(b)},error:function(a,b,c){window.console.log(a+" :: "+b+" :: "+c)}})}),window.addEventListener("load",function(){var c=document.getElementById("workflow_import_file");a(".flowmattic-re-execute-workflow-modal").removeClass("hidden"),c&&c.addEventListener("change",function(){if(c.files.length>0){var d=new FileReader;d.addEventListener("load",function(){var c=JSON.parse(d.result),e={action:"flowmattic_import_workflow",workflowData:c,workflow_nonce:FMConfig.workflow_nonce};void 0!==c.workflow_steps?a.ajax({url:ajaxurl,data:e,type:"POST",success:function(c){b.fire({title:"Workflow Imported!",html:'Your workflow has been imported successfully, and following changes were made to the imported workflow<ul class="list-group list-group-flush text-start mt-3"><li class="list-group-item">Webhook URL will be changed</li><li class="list-group-item">Workflow will be set to be in draft mode</li><li class="list-group-item">Captured data is NOT imported</li><li class="list-group-item">Workflow name will be appended with _IMPORTED to identify the imported workflow</li></ul>',icon:"success",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),a("#workflow-import-modal").modal("hide"),setTimeout(function(){window.location=window.location},5e3)},error:function(a,c,d){b.fire({title:"Workflow Import Failed!",text:"Something went wrong, and the workflow import was not succesful. Please try again.",icon:"error",showConfirmButton:!0,timer:3e3})}}):b.fire({title:"Workflow Import Failed!",text:"Uploaded file does not contain any workflow steps. Please try again with different JSON file.",icon:"error",showConfirmButton:!0,timer:5e3})}),d.readAsText(c.files[0]),a(c).val("")}})}),s.on("click",function(c){var d=a(this).data("workflow-id"),e={action:"flowmattic_clone_workflow",workflowID:d,workflow_nonce:FMConfig.workflow_nonce};c.preventDefault(),b.fire({title:"Cloning selected workflow",text:"Please wait while we clone your workflow...",showConfirmButton:!1,didOpen:function(){b.showLoading()}}),a.ajax({type:"POST",url:ajaxurl,data:e,success:function(a){b.fire({title:"Workflow Cloned!",html:'Your workflow has been cloned successfully, and following changes were made to the cloned workflow -<ul class="list-group list-group-flush text-start mt-3"><li class="list-group-item">Webhook URL will be changed</li><li class="list-group-item">Workflow will be set to be in draft mode</li><li class="list-group-item">Workflow name will be appended with _CLONED to identify the cloned workflow</li></ul>',icon:"success",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),setTimeout(function(){window.location=window.location},5e3)},error:function(a,c,d){b.fire({title:"Workflow Clone Failed!",text:"Something went wrong. Please refresh the page and try again.",icon:"error",showConfirmButton:!0,timer:3e3,timerProgressBar:!0})}})}),v.on("click",function(){var c=a(this).data("task-id"),d=a(this).data("workflow-id"),e=window["task_"+c+"_trigger"],f="";void 0!==e&&(a.each(e,function(a,b){var c=a;"number"!=typeof c&&(c=c.replaceAll("_"," ").replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})),f+='<tr>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t<input class="fm-response-form-input w-100" type="text" value="'+c+'" readonly />\t\t\t\t\t\t</td>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t<textarea class="fm-response-form-input w-100" rows="1" name="'+a+'">'+b+"</textarea>\t\t\t\t\t\t</td>"}),a(".flowmattic-re-execute-workflow-modal").removeClass("hidden"),a(".flowmattic-re-execute-workflow-modal").addClass("editor-active"),a("body").addClass("router-editor-active"),a(".fm-response-data-table").html(f)),w.on("click",function(){var c={},e={};a(".fm-re-execute-modal-body").find("textarea").each(function(){var b=a(this).attr("name"),d=a(this).val();c[b]=d}),e={action:"flowmattic_execute_workflow",workflow_id:d,workflow_nonce:FMConfig.workflow_nonce,captured_data:c},b.fire({title:"Re-executing Workflow",text:"Please wait while we re-execute your workflow",showConfirmButton:!1,didOpen:function(){b.showLoading()}}),a.ajax({url:ajaxurl,data:e,type:"POST",success:function(a){b.fire({title:"Success!",text:"Workflow is successfully executed.",icon:"success",showConfirmButton:!0,timer:2e3}),setTimeout(function(){window.location=window.location.href},2e3)}})})}),z.on("click",function(){var c=a(this).data("app"),d={};b.fire({title:"Are you sure?",text:"Once the selected app is disabled, your workflows using this core app will be paused till you manually inspect and publish them.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, disable it!",showLoaderOnConfirm:!0}).then(function(e){e.isConfirmed&&(d={action:"flowmattic_disable_core_app",appSlug:c,workflow_nonce:FMConfig.workflow_nonce},b.fire({title:"Disabling Core App",text:"Please wait while we disable your selected app",showConfirmButton:!1,didOpen:function(){b.showLoading()}}),a.ajax({url:ajaxurl,data:d,type:"POST",success:function(a){b.fire({title:"Success!",text:"App is successfully disabled.",icon:"success",showConfirmButton:!0,timer:2e3}),setTimeout(function(){window.location=window.location.href},2e3)}}))})}),A.on("click",function(){var c=a(this).data("app"),d={};d={action:"flowmattic_enable_core_app",appSlug:c,workflow_nonce:FMConfig.workflow_nonce},b.fire({title:"Enabling Core App",text:"Please wait while we enable your selected app",showConfirmButton:!1,didOpen:function(){b.showLoading()}}),a.ajax({url:ajaxurl,data:d,type:"POST",success:function(a){b.fire({title:"Success!",text:"App is successfully enabled.",icon:"success",showConfirmButton:!0,timer:2e3}),setTimeout(function(){window.location=window.location.href},2e3)}})}),x.on("click",function(){a(this).closest(".flowmattic-re-execute-workflow-modal").removeClass("editor-active"),a("body").removeClass("router-editor-active"),a(".fm-response-data-table").html("")}),y.on("click",function(){clearInterval(f),f=setInterval(e,1e4),a("body").find(".fm-workflow-apps-popup").removeClass("fm-active"),a(this).next(".fm-workflow-apps-popup").addClass("fm-active").fadeIn()}),a("body").on("click",function(b){a(b.target).is(".fm-workflow-popup-trigger")||a("body").find(".fm-workflow-apps-popup").removeClass("fm-active")}),a("body").find('[data-toggle="tooltip"]').tooltip({template:'<div class="tooltip" role="tooltip"><div class="tooltip-inner"></div></div>'})})}(jQuery);